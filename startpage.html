<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scouting Selection</title>
</head>
<body>
    <h1>Select Match and Scouting Seat</h1>
    <form id="scoutingForm">
        <input type="hidden" id="eventKey" value="2025miket"> <!-- Set your event key here -->
        <label for="matchNum">Match #:</label>
        <select id="matchNum">
            <!-- Options will be populated dynamically -->
        </select>
        <br>
        <label for="scoutingSeat">Scouting Seat:</label>
        <select id="scoutingSeat">
            <option value="red1">Red 1</option>
            <option value="red2">Red 2</option>
            <option value="red3">Red 3</option>
            <option value="blue1">Blue 1</option>
            <option value="blue2">Blue 2</option>
            <option value="blue3">Blue 3</option>
        </select>
        <br>
        <button type="submit">Go to Scouting Form</button>
    </form>

    <script>
        const apiKey = 'zu21V7xO4Yu9ny1QVq7HsrYIAEG0p015yi747MxvjUHw9Hk7de60VPxIRBA0gYRN'; // Replace with your actual API key

        document.addEventListener('DOMContentLoaded', () => {
            const eventKey = document.getElementById('eventKey').value;
            const matchNumSelect = document.getElementById('matchNum');

            fetch(`https://www.thebluealliance.com/api/v3/event/${eventKey}/matches`, {
                headers: {
                    'X-TBA-Auth-Key': apiKey
                }
            })
            .then(response => response.json())
            .then(matches => {
                matches
                    .filter(match => match.comp_level === 'qm') // Only add qualification matches
                    .sort((a, b) => a.match_number - b.match_number) // Sort matches by match number
                    .forEach(match => {
                        const option = document.createElement('option');
                        option.value = match.key.split('_')[1]; // Extract match number
                        option.textContent = match.match_number;
                        matchNumSelect.appendChild(option);
                    });
            })
            .catch(error => {
                console.error('Error fetching matches:', error);
            });
        });

        document.getElementById('scoutingForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const eventKey = document.getElementById('eventKey').value;
            const matchNum = document.getElementById('matchNum').value;
            const scoutingSeat = document.getElementById('scoutingSeat').value;

            fetch(`https://www.thebluealliance.com/api/v3/match/${eventKey}_${matchNum}`, {
                headers: {
                    'X-TBA-Auth-Key': apiKey
                }
            })
            .then(response => response.json())
            .then(data => {
                let teamNumber;
                switch (scoutingSeat) {
                    case 'red1':
                        teamNumber = data.alliances.red.team_keys[0].replace('frc', '');
                        break;
                    case 'red2':
                        teamNumber = data.alliances.red.team_keys[1].replace('frc', '');
                        break;
                    case 'red3':
                        teamNumber = data.alliances.red.team_keys[2].replace('frc', '');
                        break;
                    case 'blue1':
                        teamNumber = data.alliances.blue.team_keys[0].replace('frc', '');
                        break;
                    case 'blue2':
                        teamNumber = data.alliances.blue.team_keys[1].replace('frc', '');
                        break;
                    case 'blue3':
                        teamNumber = data.alliances.blue.team_keys[2].replace('frc', '');
                        break;
                }
                window.location.href = `index.html?team=${teamNumber}&match=${matchNum}`;
            })
            .catch(error => {
                console.error('Error fetching match data:', error);
            });
        });
    </script>
</body>
</html>